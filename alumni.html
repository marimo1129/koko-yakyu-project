<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å’æ¥­ç”Ÿä¸€è¦§ | é«˜æ ¡é‡çƒ</title>

  <!-- å…±é€šã‚¹ã‚¿ã‚¤ãƒ« -->
  <link rel="stylesheet" href="./assets/styles.css" />

  <!-- CSVã‚’ç¢ºå®Ÿã«èª­ã‚€ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆå…ˆã«èª­ã¿è¾¼ã‚€ã®ãŒè¶…é‡è¦ï¼‰ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <!-- å…±é€šJSï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ï¼‰ -->
  <script defer src="./assets/app.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand" onclick="goHome()">é«˜æ ¡é‡çƒãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¿ãƒ«</div>
    <nav class="actions">
      <button class="btn ghost" onclick="goBack()">â† æˆ»ã‚‹</button>
      <a class="btn" href="./index.html">ğŸ  ãƒ›ãƒ¼ãƒ </a>
    </nav>
  </header>

  <main class="container">
    <h1>å’æ¥­ç”Ÿä¸€è¦§</h1>

    <!-- ä¸€è¦§ã‚’æç”»ã™ã‚‹å ´æ‰€ -->
    <section id="alumniList" class="grid"></section>
  </main>

  <footer class="footer">
    <button class="icon-btn" onclick="goBack()">â† æˆ»ã‚‹</button>
    <button class="icon-btn" onclick="goHome()">ğŸ  ãƒ›ãƒ¼ãƒ </button>
  </footer>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ã“ã“ã‹ã‚‰ â€œå˜ç‹¬ã§å‹•ãæç”»ã‚¹ã‚¯ãƒªãƒ—ãƒˆâ€
       app.js ã«ä¾å­˜ã›ãšã€ã“ã‚Œã ã‘ã§ players.csv ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
       ã†ã¾ãå‹•ã„ãŸã‚‰ã€ã‚ã¨ã§ app.js ã«çµ±åˆã—ã¦OKã€‚
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <script>
  (async () => {
    try {
      // alumni.html ãŒãƒªãƒã‚¸ãƒˆãƒªç›´ä¸‹ã«ã‚ã‚‹å‰æã®ãƒ‘ã‚¹
      // ï¼ˆã‚‚ã— /scripts/ é…ä¸‹ã«ç½®ã„ã¦ã„ã‚‹ãªã‚‰ './data/...' ã‚’ '../data/...' ã«å¤‰ãˆã¦ãã ã•ã„ï¼‰
      const CSV_PATH = './data/players.csv';

      const res = await fetch(CSV_PATH);
      if (!res.ok) throw new Error(`players.csv ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ˆHTTP ${res.status}ï¼‰`);
      const text = await res.text();

      // PapaParseã§ç¢ºå®Ÿã«ãƒ‘ãƒ¼ã‚¹
      const rows = Papa.parse(text, { header: true, skipEmptyLines: true }).data;

      // è¡¨ç¤ºç”¨ã«ç©ºè¡Œã‚’é™¤å¤–
      const data = rows.filter(r => (r.player_name || '').trim());

      const list = document.querySelector('#alumniList');
      list.innerHTML = '';

      if (data.length === 0) {
        list.innerHTML = '<p class="muted">è¡¨ç¤ºã§ãã‚‹å’æ¥­ç”Ÿãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼ˆplayers.csv ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰ã€‚</p>';
        return;
      }

      // å„ã‚«ãƒ¼ãƒ‰ã‚’æç”»
      data.forEach(r => {
        const card = document.createElement('article');
        card.className = 'card';

        // ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰
        const commentHtml = (r.comment && r.comment.trim())
          ? `<p class="muted" style="margin-top:6px">${r.comment}</p>`
          : '';

        card.innerHTML = `
          <div class="content">
            <h3 class="title">${r.player_name || 'â€”'}ï¼ˆ${r.grade || ''}å¹´ãƒ»${r.position || ''}ï¼‰</h3>
            <p class="meta">${r.team_name || 'â€”'}ï¼ˆ${r.prefecture || ''}ï¼‰</p>
            <p class="meta2">å’æ¥­å¹´: ${r.graduation_year || 'â€”'}ï½œé€²è·¯: ${(r.dest_type||'â€”')}${r.dest_name ? 'ãƒ»'+r.dest_name : ''}</p>
            ${commentHtml}
          </div>
        `;

        // YouTubeï¼ˆwatch?v= / youtu.be / embed ã™ã¹ã¦å¯¾å¿œï¼‰
        const url = (r.youtube_url || '').trim();
        if (url) {
          const idMatch = url.match(/[?&]v=([\w-]{6,})|youtu\.be\/([\w-]{6,})|\/embed\/([\w-]{6,})/);
          const vid = idMatch ? (idMatch[1] || idMatch[2] || idMatch[3]) : '';
          if (vid) {
            const wrap = document.createElement('div');
            wrap.className = 'embed';
            wrap.innerHTML = `<iframe src="https://www.youtube.com/embed/${vid}" title="YouTube" frameborder="0" allowfullscreen loading="lazy"></iframe>`;
            card.querySelector('.content').appendChild(wrap);
          }
        }

        list.appendChild(card);
      });

      console.log('Alumni rendered:', data.length, 'rows');
    } catch (err) {
      console.error(err);
      const list = document.querySelector('#alumniList');
      list.innerHTML = `<p class="muted">ã‚¨ãƒ©ãƒ¼ï¼š${err.message}</p>`;
    }
  })();
  </script>
  <!-- ======== å¼·åˆ¶è¨ºæ–­ã¤ã å’æ¥­ç”Ÿæç”»ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ======== -->
<script>
(async () => {
  // ç”»é¢ä¸Šã«è¨ºæ–­ãƒ­ã‚°ã‚’å‡ºã™å°ã•ã„é ˜åŸŸ
  const logBox = document.createElement('pre');
  logBox.style.background = '#111';
  logBox.style.color = '#9aa4af';
  logBox.style.padding = '8px 12px';
  logBox.style.border = '1px solid #333';
  logBox.style.borderRadius = '8px';
  logBox.style.maxWidth = '960px';
  logBox.style.margin = '12px auto';
  logBox.style.fontSize = '12px';
  logBox.style.whiteSpace = 'pre-wrap';
  logBox.textContent = 'è¨ºæ–­ãƒ­ã‚°:\n';
  document.querySelector('main.container').insertBefore(logBox, document.querySelector('#alumniList'));

  const log = (...args) => { logBox.textContent += args.join(' ') + '\n'; console.log(...args); };

  try {
    // 3å€™è£œã®ãƒ‘ã‚¹ã‚’é †ç•ªã«è©¦ã™ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¹ã‚¿ãƒ¼ä»˜ãï¼‰
    const candidates = [
      './data/players.csv',
      '../data/players.csv',
      '/koko-yakyu-project/data/players.csv'
    ];

    let csvText = null;
    let usedPath = null;

    for (const base of candidates) {
      const url = base + (base.includes('?') ? '&' : '?') + 'v=' + Date.now();
      log('TRY:', url);
      try {
        const res = await fetch(url, { cache: 'no-store' });
        log('  status =', res.status, res.statusText);
        if (res.ok) {
          const txt = await res.text();
          log('  text(0..120)=', txt.slice(0, 120).replace(/\n/g, '\\n'));
          csvText = txt;
          usedPath = base;
          break;
        }
      } catch (e) {
        log('  fetch error:', e.message);
      }
    }

    if (!csvText) {
      throw new Error('CSVã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ˆ3å€™è£œã™ã¹ã¦å¤±æ•—ï¼‰');
    }

    log('USED PATH:', usedPath);

    // PapaParse ã§ãƒ‘ãƒ¼ã‚¹
    let parsed;
    try {
      parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });
    } catch (e) {
      log('Papa.parse error:', e.message);
      throw e;
    }

    if (parsed.errors && parsed.errors.length) {
      log('Papa errors (å…ˆé ­1ä»¶):', JSON.stringify(parsed.errors[0]));
    }

    const rows = Array.isArray(parsed.data) ? parsed.data : [];
    log('rows.length =', rows.length);
    const data = rows.filter(r => (r.player_name || '').trim());
    log('displayable =', data.length);

    const list = document.querySelector('#alumniList');
    list.innerHTML = '';

    if (data.length === 0) {
      list.innerHTML = '<p class="muted">è¡¨ç¤ºã§ãã‚‹å’æ¥­ç”Ÿãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆplayers.csv ã®ãƒ˜ãƒƒãƒ€åã¨å€¤ã‚’ç¢ºèªï¼‰ã€‚</p>';
      return;
    }

    // ã‚«ãƒ¼ãƒ‰æç”»
    data.forEach(r => {
      const card = document.createElement('article');
      card.className = 'card';
      card.innerHTML = `
        <div class="content">
          <h3 class="title">${r.player_name || 'â€”'}ï¼ˆ${r.grade || ''}å¹´ãƒ»${r.position || ''}ï¼‰</h3>
          <p class="meta">${r.team_name || 'â€”'}ï¼ˆ${r.prefecture || ''}ï¼‰</p>
          <p class="meta2">å’æ¥­å¹´: ${r.graduation_year || 'â€”'}ï½œé€²è·¯: ${(r.dest_type||'â€”')}${r.dest_name ? 'ãƒ»'+r.dest_name : ''}</p>
          ${(r.comment && r.comment.trim()) ? `<p class="muted" style="margin-top:6px">${r.comment}</p>` : ``}
        </div>
      `;

      // YouTubeåŸ‹ã‚è¾¼ã¿
      const url = (r.youtube_url || '').trim();
      if (url) {
        const m = url.match(/[?&]v=([\w-]{6,})|youtu\.be\/([\w-]{6,})|\/embed\/([\w-]{6,})/);
        const vid = m ? (m[1] || m[2] || m[3]) : '';
        if (vid) {
          const wrap = document.createElement('div');
          wrap.className = 'embed';
          wrap.innerHTML = `<iframe src="https://www.youtube.com/embed/${vid}" title="YouTube" frameborder="0" allowfullscreen loading="lazy"></iframe>`;
          card.querySelector('.content').appendChild(wrap);
        }
      }

      list.appendChild(card);
    });

    log('RENDERED:', data.length, 'cards');
  } catch (e) {
    const list = document.querySelector('#alumniList');
    list.innerHTML = `<p class="muted">ã‚¨ãƒ©ãƒ¼ï¼š${e.message}</p>`;
    log('FATAL:', e.message);
  }
})();
</script>
<!-- ======== /è¨ºæ–­ã¤ãã‚¹ã‚¯ãƒªãƒ—ãƒˆ ======== -->

</body>
</html>
