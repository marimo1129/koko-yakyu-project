<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é«˜æ ¡é‡çƒ INDEX</title>
  <link rel="stylesheet" href="./assets/styles.css" />
  <script defer src="./assets/app.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand" onclick="goHome()">é«˜æ ¡é‡çƒãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¿ãƒ«</div>
    <nav class="actions">
      <a class="btn" href="./teams.html">ãƒãƒ¼ãƒ ä¸€è¦§</a>
      <a class="btn" href="./alumni.html">å’æ¥­ç”Ÿä¸€è¦§</a>
    </nav>
  </header>
  <main class="container">
    <h1>åœ°åŸŸä¸€è¦§</h1>
    <section class="grid">
      <a class="card" href="#">è¿‘ç•¿</a>
      <a class="card" href="#">é–¢æ±</a>
    </section>
  </main>
  <footer class="footer">
    <button class="icon-btn" onclick="goHome()">ğŸ  ãƒ›ãƒ¼ãƒ </button>
  </footer>
<!-- === Players Scores (2025) === -->
<section id="players-scores" style="max-width:1000px;margin:40px auto;padding:16px;border:1px solid #eee;border-radius:12px">
  <h2 style="margin:0 0 12px">2025 æ³¨ç›®é¸æ‰‹ã‚¹ã‚³ã‚¢</h2>

  <div style="display:flex;gap:12px;align-items:center;margin:8px 0 16px">
    <label>å­¦æ ¡ã§çµã‚Šè¾¼ã¿ï¼š
      <select id="schoolFilter">
        <option value="">ï¼ˆå…¨æ ¡ï¼‰</option>
      </select>
    </label>
    <label>è¡¨ç¤ºä»¶æ•°ï¼š
      <select id="limit">
        <option>10</option><option selected>20</option><option>50</option><option>100</option>
      </select>
    </label>
    <button id="reload">æ›´æ–°</button>
  </div>

  <div style="overflow:auto">
    <table id="scoresTable" style="width:100%;border-collapse:collapse">
      <thead>
        <tr>
          <th style="text-align:left;border-bottom:1px solid #ddd;padding:8px">å­¦æ ¡</th>
          <th style="text-align:left;border-bottom:1px solid #ddd;padding:8px">é¸æ‰‹</th>
          <th style="text-align:left;border-bottom:1px solid #ddd;padding:8px">å®ˆå‚™</th>
          <th style="text-align:right;border-bottom:1px solid #ddd;padding:8px">AIã‚¹ã‚³ã‚¢</th>
          <th style="text-align:left;border-bottom:1px solid #ddd;padding:8px">æ ¹æ‹ </th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<script>
// ã–ã£ãã‚ŠCSVãƒ‘ãƒ¼ã‚µï¼ˆã‚«ãƒ³ãƒã‚’å«ã‚€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆå¯¾å¿œï¼‰
function parseCSV(text){
  const rows = [];
  let cur = '', row = [], inside = false;
  for (let i=0;i<text.length;i++){
    const c = text[i], n = text[i+1];
    if (c === '"' && n === '"'){ cur += '"'; i++; continue; }
    if (c === '"'){ inside = !inside; continue; }
    if (c === ',' && !inside){ row.push(cur); cur=''; continue; }
    if ((c === '\n' || c === '\r') && !inside){
      if (cur!=='' || row.length){ row.push(cur); rows.push(row); row=[]; cur=''; }
      continue;
    }
    cur += c;
  }
  if (cur!=='' || row.length){ row.push(cur); rows.push(row); }
  return rows;
}

async function loadScores(){
  const res = await fetch('data/player_scores_2025.csv'); // ã“ã“ã‚’å¹´ã”ã¨ã«å¤‰ãˆã‚‹
  const text = await res.text();
  const rows = parseCSV(text).filter(r => r.length && r.some(x=>x.trim()!==''));
  const header = rows[0].map(h=>h.trim());
  const data = rows.slice(1).map(r=>{
    const obj = {};
    header.forEach((h,idx)=>obj[h]=r[idx] ?? '');
    return obj;
  });

  // æ¬„åã®æƒ³å®šï¼ˆcollect_players.py ã®å‡ºåŠ›ã«åˆã‚ã›ã¦ã„ã¾ã™ï¼‰
  // year,school_name,player_name,position,AI_score,basis ãªã©
  // æ•°å€¤åŒ–
  data.forEach(d => d.AI_score = parseFloat(d.AI_score || d.ai_score || d.score || 0));

  // å­¦æ ¡ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’ä½œæˆ
  const schools = Array.from(new Set(data.map(d=>d.school_name).filter(Boolean))).sort();
  const sel = document.getElementById('schoolFilter');
  sel.innerHTML = '<option value="">ï¼ˆå…¨æ ¡ï¼‰</option>' + schools.map(s=>`<option>${s}</option>`).join('');

  // è¡¨ç¤ºå‡¦ç†
  function render(){
    const limit = parseInt(document.getElementById('limit').value,10) || 20;
    const filter = sel.value.trim();
    const tbody = document.querySelector('#scoresTable tbody');
    let filtered = data.slice();
    if (filter) filtered = filtered.filter(d => d.school_name === filter);
    filtered.sort((a,b)=> (b.AI_score||0) - (a.AI_score||0));
    const rowsHTML = filtered.slice(0, limit).map(d=>`
      <tr>
        <td style="padding:8px;border-bottom:1px solid #f0f0f0">${d.school_name||''}</td>
        <td style="padding:8px;border-bottom:1px solid #f0f0f0">${d.player_name||''}</td>
        <td style="padding:8px;border-bottom:1px solid #f0f0f0">${d.position||''}</td>
        <td style="padding:8px;border-bottom:1px solid #f0f0f0;text-align:right">${(d.AI_score??'').toString()}</td>
        <td style="padding:8px;border-bottom:1px solid #f0f0f0">${d.basis||d.Basis||''}</td>
      </tr>`).join('');
    tbody.innerHTML = rowsHTML || `<tr><td colspan="5" style="padding:12px;color:#888">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>`;
  }

  document.getElementById('reload').onclick = render;
  document.getElementById('limit').onchange = render;
  sel.onchange = render;

  render();
}
loadScores();
</script>

</body>
</html>
